{% extends "base.html" %}
{% load markdownify %}

{% block content %}

<h1>{{ question.title }}</h1>
{% if user.is_authenticated %}
{% if user_favorite_question %}
<a id="favorited" data-question-id="{{ question.pk }}" href="#">&#9734;</a>
{% else %}
<a id="favorited" data-question-id="{{ question.pk }}" href="#">&#11088;</a>
{% endif %}
{% endif %}
<p>Tags</p>
<div>
    {% for tag in question.tags.all %}
        <a class="" href="{% url 'show_tag' tag_name=tag.tag %}">{{ tag }}</a>
    {% endfor %}
</div>
<p>{{ question.user }}</p>
<p>{{ question.body |markdownify }}</p>

{% if user.is_authenticated %}
<a href="{% url 'add_answer' question_pk=question.pk %}">Add an Answer</a>
{% endif %}

<h3>Answers</h3>
    {% for answer in answers %}
        <ul id="answer-{{ answer.pk }}">{{ answer.title }}
            <li>User: {{ answer.author }}</li>
            <li>{{ answer.body |markdownify }}</li>
        </ul>
    {% endfor %}

{% if user.is_authenticated %}
<a class="bg-gray f5 link dim br3 ph3 pv2 mb2 dib fw5" href="{% url 'delete_question' question_pk=question.pk %}">Delete Question</a>
{% endif %}

<script>
    const favoriteQuestionLink = document.querySelector("#favorited")
    favoriteQuestionLink.addEventListener("click", event => {
        event.preventDefault()
        const questionId = favoriteQuestionLink.dataset.questionId
        fetch('/core/' + questionId + '/favorite/', {
            method: 'POST',
            credentials: 'include'
        })
        .then(res => res.json())
        .then(data => {
            if (data.isFavorite) {
                favoriteQuestionLink.innerHTML = '&#9734'
            } else {
                favoriteQuestionLink.innerHTML = '&#11088;'
            }
        })
    })
</script>


{% endblock %} 